"0","```r


whippet_ME_age_stats <- function(Delta_S_whippet, Delta_S_ME) { 


  Delta_S_whippet_ME <- merge(Delta_S_whippet, Delta_S_ME, by=c(\"exon_ID\", \"Gene\", \"Node\",  \"Coord\", \"Strand\", \"Type\", \"age\") )
  
  Delta_S_whippet_ME[ (abs(DeltaPsi.x)>=0.1 &  Probability.x >= 0.9) &  (abs(DeltaPsi.y)>=0.1 &  Probability.y >= 0.9) , .N , by=(age)]
  
  Delta_S_whippet_ME_included <- Delta_S_whippet_ME[ (DeltaPsi.x<=-0.1 &  Probability.x >= 0.9) &  (DeltaPsi.y<=-0.1 &  Probability.y >= 0.9)  , .N , by=(age)]
  Delta_S_whippet_ME_excluded <- Delta_S_whippet_ME[ (DeltaPsi.x>=0.1 &  Probability.x >= 0.9) &  (DeltaPsi.y>=0.1 &  Probability.y >= 0.9)  , .N , by=(age)]
  
  
  #Delta_S_included_stats <- cbind(Delta_S_whippet_included[order(age)], Delta_S_ME_included[order(age), 2], Delta_S_whippet_ME_included[order(age), 2])
  #colnames(Delta_S_included_stats) <- c(\"age\", \"Whippet\", \"MicroExonator\", \"Both\")
  
  
  
  Delta_S_whippet_ME[, diff_high:=FALSE]
  Delta_S_whippet_ME[ (abs(DeltaPsi.x)>=0.1 &  Probability.x >= 0.9) &  (abs(DeltaPsi.y)>=0.1 &  Probability.y >= 0.9) , diff_high:=TRUE]
  
  Delta_S_whippet_ME[, diff_low:=FALSE]
  Delta_S_whippet_ME[ (abs(DeltaPsi.x)>=0.1 &  Probability.x >= 0.8) &  (abs(DeltaPsi.y)>=0.1 &  Probability.y >= 0.8) , diff_low:=TRUE]
  
  
  ages <- sort(unique(Delta_S_whippet_ME$age))
  age_int <- c(ages[length(ages)])
  
  
    
  for (a in rev(ages[1:length(ages)-1])){
    
    age_int = cbind(age_int, a)
    
    Delta_S_whippet_ME[ age==a & diff_high==TRUE &  exon_ID %in% Delta_S_whippet_ME[age %in% age_int & diff_high==TRUE, .N, by=c(\"exon_ID\", \"Gene\") ][N==length(age_int)]$exon_ID   , diff_age:=a ]
  }
    
  Delta_S_whippet_ME_age_diff <- Delta_S_whippet_ME[ diff_high==TRUE, .(diff_age = min(diff_age, na.rm = TRUE)), by=c(\"exon_ID\", \"Gene\")]
  
  
  Delta_S_whippet_ME$delta_sing <- sign(Delta_S_whippet_ME$DeltaPsi.x)
  
  Delta_S_whippet_ME_diff_count <- Delta_S_whippet_ME[diff_high==TRUE , .N , by=c(\"exon_ID\", \"delta_sing\")]
  rescue_exons <- Delta_S_whippet_ME_diff_count[N>=2 & !exon_ID %in% Delta_S_whippet_ME_age_diff[diff_age!=Inf, ]$exon_ID , ]$exon_ID
  
  
  #ages <- Delta_S_included_stats$age
  #age_int <- c(ages[length(ages)])
  Delta_S_whippet_ME[exon_ID %in% rescue_exons]
  
    
  for (a in rev(ages[1:length(ages)-1])){
    
    age_int = cbind(age_int, a)
    
    Delta_S_whippet_ME[exon_ID %in% rescue_exons & age==a & diff_low==TRUE &  exon_ID %in% Delta_S_whippet_ME[age %in% age_int & diff_low==TRUE, .N, by=c(\"exon_ID\", \"Gene\") ][N==length(age_int)]$exon_ID   , diff_age_low:=a ]
  }
    
  
  Delta_S_whippet_ME_age_diff_low <- Delta_S_whippet_ME[ diff_low==TRUE, .(diff_age = min(diff_age_low, na.rm = TRUE)), by=c(\"exon_ID\", \"Gene\")]
  
  
  diff_ME_sing <- Delta_S_whippet_ME[diff_high==TRUE, -sign(DeltaPsi.y)]
  names(diff_ME_sing) <- Delta_S_whippet_ME[diff_high==TRUE, exon_ID]
  
  
  Delta_S_whippet_ME_age_diff_total <-  rbind(Delta_S_whippet_ME_age_diff[diff_age!=Inf], Delta_S_whippet_ME_age_diff_low[diff_age!=Inf])
  
  Delta_S_whippet_ME_age_diff_total[, change_dir:=diff_ME_sing[exon_ID] ]
  
  return(Delta_S_whippet_ME_age_diff_total)

}

```"
