{
    "collab_server" : "",
    "contents" : "---\ntitle: \"R Notebook\"\noutput: html_notebook\n---\n\n```{r}\nlibrary(data.table)\nlibrary(UpSetR)\n```\n```{r}\nOK1\n```\n\n\n```{r}\n\nOK1 <- fread(\"Delta/ref/WT-vs-KO_1.diff\")\nOK2 <- fread(\"Delta/ref/WT-vs-KO_2.diff\")\nOK3 <- fread(\"Delta/ref/WT-vs-KO_3.diff\")\nOK4 <- fread(\"Delta/ref/WT-vs-KO_4.diff\")\n\n\ncolnames(OK1) <- c(\"Gene\", \"Node\", \"Coord\", \"Strand\", \"Type\", \"Psi_A\", \"Psi_B\", \"DeltaPsi\", \"Probability\", \"Complexity\", \"Entropy\", \"NA\")\ncolnames(OK2) <- c(\"Gene\", \"Node\", \"Coord\", \"Strand\", \"Type\", \"Psi_A\", \"Psi_B\", \"DeltaPsi\", \"Probability\", \"Complexity\", \"Entropy\", \"NA\") \ncolnames(OK3) <- c(\"Gene\", \"Node\", \"Coord\", \"Strand\", \"Type\", \"Psi_A\", \"Psi_B\", \"DeltaPsi\", \"Probability\", \"Complexity\", \"Entropy\", \"NA\") \ncolnames(OK4) <- c(\"Gene\", \"Node\", \"Coord\", \"Strand\", \"Type\", \"Psi_A\", \"Psi_B\", \"DeltaPsi\", \"Probability\", \"Complexity\", \"Entropy\", \"NA\") \n```\n\n\n\n\n\n\n\n\n\n\n\n\n```{r}\n\nTOTAL.OK.CE <- list(OK1 = OK1[ abs(DeltaPsi)>0.1 & Probability>0.9  & Type==\"CE\", paste(Gene, Node, sign(DeltaPsi), sep=\"_\")],\n                    OK2 = OK2[ abs(DeltaPsi)>0.1 & Probability>0.9  & Type==\"CE\", paste(Gene, Node, sign(DeltaPsi), sep=\"_\")],\n                    OK3 = OK3[ abs(DeltaPsi)>0.1 & Probability>0.9  & Type==\"CE\", paste(Gene, Node, sign(DeltaPsi), sep=\"_\")],\n                    OK4 = OK4[ abs(DeltaPsi)>0.1 & Probability>0.9  & Type==\"CE\", paste(Gene, Node, sign(DeltaPsi), sep=\"_\")])\n\n\n\nupset(fromList(TOTAL.OK.CE), order.by = \"freq\", nsets = 4, keep.order = T)\n\n```\n\n\n\n\n```{r}\n\nTOTAL.OK <- list(OK1 = OK1[ abs(DeltaPsi)>0.1 & Probability>0.9, paste(Gene, Node, sign(DeltaPsi), sep=\"_\")],\n                    OK2 = OK2[ abs(DeltaPsi)>0.1 & Probability>0.9, paste(Gene, Node, sign(DeltaPsi), sep=\"_\")],\n                    OK3 = OK3[ abs(DeltaPsi)>0.1 & Probability>0.9, paste(Gene, Node, sign(DeltaPsi), sep=\"_\")],\n                    OK4 = OK4[ abs(DeltaPsi)>0.1 & Probability>0.9, paste(Gene, Node, sign(DeltaPsi), sep=\"_\")])\n\n\n\nupset(fromList(TOTAL.OK), order.by = \"freq\", nsets = 4, keep.order = T)\n\n```\n\n\n\n```{r}\nOK1[ , `:=`(ID=paste(Gene, Node, sign(DeltaPsi),  sep=\"_\"), diff=FALSE )]\nOK2[ , `:=`(ID=paste(Gene, Node, sign(DeltaPsi),  sep=\"_\"), diff=FALSE )]\nOK3[ , `:=`(ID=paste(Gene, Node, sign(DeltaPsi),  sep=\"_\"), diff=FALSE )]\nOK4[ , `:=`(ID=paste(Gene, Node, sign(DeltaPsi),  sep=\"_\"), diff=FALSE )]\n\nOK1[ abs(DeltaPsi)>0.1 & Probability>0.9, diff:=TRUE]\nOK2[ abs(DeltaPsi)>0.1 & Probability>0.9, diff:=TRUE]\nOK3[ abs(DeltaPsi)>0.1 & Probability>0.9, diff:=TRUE]\nOK4[ abs(DeltaPsi)>0.1 & Probability>0.9, diff:=TRUE]\n\n\n\nTOTAL.OK.Merge <- Reduce(function(...) merge(..., all = TRUE, by = c(\"Gene\", \"Node\", \"Coord\", \"Type\", \"ID\") ), \n       list(OK1[, c(\"Gene\", \"Node\", \"Coord\", \"Type\", \"ID\", \"DeltaPsi\", \"Probability\", \"diff\")],\n            OK2[, c(\"Gene\", \"Node\", \"Coord\", \"Type\", \"ID\", \"DeltaPsi\", \"Probability\", \"diff\")],\n            OK3[, c(\"Gene\", \"Node\", \"Coord\", \"Type\", \"ID\", \"DeltaPsi\", \"Probability\", \"diff\")],\n            OK4[, c(\"Gene\", \"Node\", \"Coord\", \"Type\", \"ID\", \"DeltaPsi\", \"Probability\", \"diff\")]))\n\n\ncolnames(TOTAL.OK.Merge) <- c(\"Gene\", \"Node\", \"Coord\", \"Type\", \"ID\", \"DeltaPsi.1\", \"Probability.1\", \"diff.1\", \"DeltaPsi.2\", \"Probability.2\", \"diff.2\", \"DeltaPsi.3\", \"Probability.3\", \"diff.3\", \"DeltaPsi.4\", \"Probability.4\", \"diff.4\")\n\n\nTOTAL.OK.Merge[is.na(diff.1), diff.1:=FALSE]\nTOTAL.OK.Merge[is.na(diff.2), diff.2:=FALSE]\nTOTAL.OK.Merge[is.na(diff.3), diff.3:=FALSE]\nTOTAL.OK.Merge[is.na(diff.4), diff.4:=FALSE]\n\nTOTAL.OK.Merge[, Number_diff:= (diff.1 + diff.2 + diff.3 + diff.4)]\n\n\nTOTAL.OK.Merge[ , .N , by=c(\"Type\", \"Number_diff\") ]\n\n\n```\n\n\n```{r}\nlibrary(biomaRt)\n\nunique(TOTAL.OK.Merge[, Gene])\n\n\n\nMicroExon_genes <- gsub(\"\\\\..*\",\"\", Delta_HNM_whippet_ME$Gene) \nnames(MicroExon_genes) <- Delta_HNM_whippet_ME$exon_ID\n \nDelta_HNM_whippet_ME_age_diff_total[, ensembl_gene_id:=MicroExon_genes[exon_ID]]\n\nensembl = useEnsembl(biomart=\"ensembl\", dataset=\"hsapiens_gene_ensembl\")\n\n\nView(listAttributes(ensembl))\n\n\ngene_table <- data.table(getBM(attributes=c('ensembl_gene_id', \"hgnc_symbol\", \"wikigene_description\"),filters = 'ensembl_gene_id', values = unique(TOTAL.OK.Merge[, Gene]) , mart = ensembl))\n\n\nTOTAL.OK.Merge.mart <- merge(TOTAL.OK.Merge, gene_table, by.x=\"Gene\", by.y=\"ensembl_gene_id\", all.x=TRUE)\n\nfwrite( TOTAL.OK.Merge.mart, \"TOTAL.OK.Merge.mart.txt\", quote = FALSE, col.names = TRUE, sep=\"\\t\")\n```\n\n\n# Differential gene expression analysis\n\n\n\n```{r}\ndeseq2.OK1 <- read.csv(\"./diffexp/WT-vs-KO_1.diffexp.tsv\", sep = \" \")\ndeseq2.OK2 <- read.csv(\"./diffexp/WT-vs-KO_2.diffexp.tsv\", sep = \" \")\ndeseq2.OK3 <- read.csv(\"./diffexp/WT-vs-KO_3.diffexp.tsv\", sep = \" \")\ndeseq2.OK4 <- read.csv(\"./diffexp/WT-vs-KO_4.diffexp.tsv\", sep = \" \")\n\ndeseq2.OK1$Gene <- row.names(deseq2.OK1)\ndeseq2.OK2$Gene <- row.names(deseq2.OK2)\ndeseq2.OK3$Gene <- row.names(deseq2.OK3)\ndeseq2.OK4$Gene <- row.names(deseq2.OK4)\n\ndeseq2.OK1 <- data.table(deseq2.OK1)\ndeseq2.OK2 <- data.table(deseq2.OK2)\ndeseq2.OK3 <- data.table(deseq2.OK3)\ndeseq2.OK4 <- data.table(deseq2.OK4)\n\n\ndeseq2.OK1[ , `:=`(ID=paste(Gene, sign(log2FoldChange),  sep=\"_\"), diff=FALSE )]\ndeseq2.OK2[ , `:=`(ID=paste(Gene, sign(log2FoldChange),  sep=\"_\"), diff=FALSE )]\ndeseq2.OK3[ , `:=`(ID=paste(Gene, sign(log2FoldChange),  sep=\"_\"), diff=FALSE )]\ndeseq2.OK4[ , `:=`(ID=paste(Gene, sign(log2FoldChange),  sep=\"_\"), diff=FALSE )]\n\ndeseq2.OK1[  padj<0.05 & abs(log2FoldChange)>1 , diff:=TRUE]\ndeseq2.OK2[  padj<0.05 & abs(log2FoldChange)>1 , diff:=TRUE]\ndeseq2.OK3[  padj<0.05 & abs(log2FoldChange)>1 , diff:=TRUE]\ndeseq2.OK4[  padj<0.05 & abs(log2FoldChange)>1 , diff:=TRUE]\n\n\ndeseq2.OK.TOTAL <- Reduce(function(...) merge(..., all = TRUE, by = c(\"ID\", \"Gene\") ), \n       list(deseq2.OK1[, c(\"ID\", \"Gene\", \"log2FoldChange\", \"padj\", \"diff\")],\n            deseq2.OK2[, c(\"ID\", \"Gene\", \"log2FoldChange\", \"padj\", \"diff\")],\n            deseq2.OK3[, c(\"ID\" , \"Gene\", \"log2FoldChange\", \"padj\", \"diff\")],\n            deseq2.OK4[, c(\"ID\" , \"Gene\", \"log2FoldChange\", \"padj\", \"diff\")]))\n\ncolnames(deseq2.OK.TOTAL) <- c(\"ID\", \"Gene\", \"log2FoldChange.1\", \"padj.1\", \"diff.1\",  \"log2FoldChange.2\", \"padj.2\", \"diff.2\", \"log2FoldChange.3\", \"padj.3\", \"diff.3\", \"log2FoldChange.4\", \"padj.4\", \"diff.4\" )\n\n\ndeseq2.OK.TOTAL[is.na(diff.1), diff.1:=FALSE]\ndeseq2.OK.TOTAL[is.na(diff.2), diff.2:=FALSE]\ndeseq2.OK.TOTAL[is.na(diff.3), diff.3:=FALSE]\ndeseq2.OK.TOTAL[is.na(diff.4), diff.4:=FALSE]\n\ndeseq2.OK.TOTAL[, Number_diff:= (diff.1 + diff.2 + diff.3 + diff.4)]\n\ndeseq2.OK.TOTAL[ Number_diff==4,]\n\nfwrite( deseq2.OK.TOTAL, \"deseq2.OK.TOTAL.txt\", quote = FALSE, col.names = TRUE, sep=\"\\t\")\n```\n\n\n```{r}\n\ndeseq2.OK.TOTAL.list <- list(OK1 = deseq2.OK.TOTAL[ diff.1==TRUE, ID],\n                    OK2 = deseq2.OK.TOTAL[ diff.2==TRUE, ID],\n                    OK3 = deseq2.OK.TOTAL[ diff.3==TRUE, ID],\n                    OK4 = deseq2.OK.TOTAL[ diff.4==TRUE, ID])\n\n\n\nupset(fromList(deseq2.OK.TOTAL.list), order.by = \"freq\", nsets = 4, keep.order = T)\n\n```\n\n\n```{r}\ndeseq2.OK.TOTAL[ diff.1==TRUE, ID]\n```\n\n",
    "created" : 1589933557271.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2489878160",
    "id" : "78A13CAA",
    "lastKnownWriteTime" : 1589600000,
    "last_content_update" : 1589600000,
    "path" : "~/Google_Drive/Results/Dhiru/Whippet_analysis.Rmd",
    "project_path" : null,
    "properties" : {
        "chunk_output_type" : "inline"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}